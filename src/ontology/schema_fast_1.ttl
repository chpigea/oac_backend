@prefix sh:   		<http://www.w3.org/ns/shacl#> .
#@prefix ex:   		<http://example.org/shapes/> .
@prefix rdf:  		<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: 		<http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:  		<http://www.w3.org/2001/XMLSchema#> .
@prefix owl:  		<http://www.w3.org/2002/07/owl#> .
@prefix crm:  		<http://www.cidoc-crm.org/cidoc-crm/> .
@prefix basecpm: 	<http://ontome.net/ns/cpm/> .
@prefix j.0: 		<http://www.cidoc-crm.org/extensions/crmsci/> . 
#@prefix crmsci: 	<http://www.ics.forth.gr/isl/CRMsci> .
@prefix base: 		<http://www.ics.forth.gr/isl/CRMinf/> .
#@prefix volipi: 	<http://data.sparna.fr/ontologies/volipi#> .
#@prefix skos: 		<http://www.w3.org/2004/02/skos/core> .
@prefix indagine: 	<http://indagine/> .
@prefix this: 		<http://data.mydomain.com/sparnatural-page/sparnatural-config/> .

@prefix dash: 		<http://datashapes.org/dash#> .
@prefix core: 		<http://data.sparna.fr/ontologies/sparnatural-config-core#> .
@prefix datasources: <http://data.sparna.fr/ontologies/sparnatural-config-datasources#> .


this:E7ActivityIndagineLabel # LABEL INDAGINE
	sh:path rdfs:label ;
	sh:name "Label indagine" ;
	sh:nodeKind sh:Literal ;
	sh:datatype rdf:string ;
	dash:searchWidget core:NonSelectableProperty ; # ???
	dash:propertyRole dash:LabelRole ;
	core:enableOptional "false"^^xsd:boolean ;
	core:enableNegation "false"^^xsd:boolean .

this:E7ActivityIndagine # INDAGINE
    a sh:NodeShape ;
    sh:targetClass crm:E7_Activity ;
	rdfs:label "Indagine" ; 
	sh:property [
        sh:path crm:P48_has_preferred_identifier ;
		sh:node this:E42IdentifierIndagine ;
		sh:name "ha identificativo" ;
    ] ;
    sh:property [
        sh:path crm:P17_was_motivated_by ;
        sh:node this:I12AdoptedBelief ;
		sh:name "è motivato da" ;
    ] ;
    sh:property [
        sh:path crm:P14_carried_out_by ;
        sh:node this:E39ActorIndagine ;
		sh:name "eseguito da" ;
    ] ;
    sh:property [
        sh:path crm:P16_used_specific_object ;
        sh:node this:S13SampleCampione ;
		sh:name "ha usato un oggetto specifico" ;
    ] ; 
		sh:property this:E7ActivityIndagineLabel .

this:E39ActorIndagine # ATTORI
    a sh:NodeShape ;
    sh:targetClass crm:E39_Actor ;
	rdfs:label "Attori coinvolti" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeAttori ;
		sh:name "ha tipo" ;
    ] .

this:S13SampleCampione # CAMPIONE
    a sh:NodeShape ;
    sh:targetClass j.0:S13_Sample ;
	rdfs:label "Campione" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P2_has_type ; 
        sh:node this:E55TypeCampione ;
		sh:name "ha tipo" ;
    ] ;
    sh:property [
        sh:path basecpm:PC43i_uses ;
        sh:node this:CP2ArchitectureWork ;
		sh:name "utilizza" ;
    ] .

this:CP2ArchitectureWork # BENE DI RIFERIMENTO
    a sh:NodeShape ;
    sh:targetClass basecpm:CP2_Architecture_Work ;
	rdfs:label "Bene di riferimento" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P1_is_identified_by ;
        sh:node this:E41AppellationBene ;
		sh:name "è identificato da" ;
    ] .

this:E42IdentifierIndagine # ID INDAGINE
    a sh:NodeShape ;
    sh:targetClass crm:E42_Identifier ;
	rdfs:label "ID Indagine" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
       sh:path indagine:id_indagine ;
		sh:name "ID" ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] .

this:I12AdoptedBelief # QUESITO DIAGNOSTICO
    a sh:NodeShape ;
    sh:targetClass base:I12_Adopted_Belief ;
	rdfs:label "Quesito diagnostico" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeQuesito ;
		sh:name "ha tipo" ;
		#dash:searchWidget core:AutocompleteProperty ;
		#dash:propertyRole dash:LabelRole ;
    ] .

this:E41AppellationEnteRichSchedatore # ENTE RICHIEDENTE
    a sh:NodeShape ;
    sh:targetClass crm:E41_Appellation ;
	rdfs:label "Ente richiedente - Schedatore" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:ente_richiedente ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "ente richiedente" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
        #sh:maxCount 1 ; 
    ] ;
    sh:property [
        sh:path indagine:schedatore ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "schedatore" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
        #sh:maxCount 1 ; 
    ] .

this:E41AppellationBene # DENOMINAZIONE BENE
    a sh:NodeShape ;
    sh:targetClass crm:E41_Appellation ;
	rdfs:label "Denominazione bene" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
		sh:path indagine:denominazione_bene ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "denominazione" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] .
	
this:E55TypeQuesito # TIPO QUESITO DIAGNOSTICO
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tipo quesito diagnostico" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_quesito_diagnostico ;
		sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_quesito_diagnostico ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55TypeAttori # TIPOLOGIA ATTORI
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tipo attori" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P1_is_identified_by ;
        sh:node this:E41AppellationEnteRichSchedatore ;
		sh:name "è identificato da" ;
        #sh:maxCount 1 ; 
    ] .

this:E55TypeCampione # TIPO CAMPIONE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
    rdfs:label "Tipo campione" ;
    sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_campione ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_campione ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .


# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO CAMPIONE" (21)
this:tree_root_tipo_campione a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/tipo-campione> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO QUESITO DIAGNOSTICO" (8)
this:tree_root_tipo_quesito_diagnostico a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/quesito-diagnostico> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO SUCCESSIVI 1° LIVELLO (vale per tutti i vocabolari)
this:tree_children_broader_term a datasources:SparqlTreeChildrenDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?uri ?label (EXISTS { ?child crm:P127_has_broader_term ?uri } AS ?hasChildren)
WHERE {
    ?uri crm:P127_has_broader_term $node .
    OPTIONAL { ?uri rdfs:label ?label . }
}
ORDER BY ?label
""" .    
