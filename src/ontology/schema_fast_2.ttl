@prefix sh:   		<http://www.w3.org/ns/shacl#> .
#@prefix ex:   		<http://example.org/shapes/> .
@prefix rdf:  		<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: 		<http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:  		<http://www.w3.org/2001/XMLSchema#> .
@prefix owl:  		<http://www.w3.org/2002/07/owl#> .
@prefix crm:  		<http://www.cidoc-crm.org/cidoc-crm/> .
@prefix basecpm: 	<http://ontome.net/ns/cpm/> .
@prefix j.0: 		<http://www.cidoc-crm.org/extensions/crmsci/> . 
#@prefix crmsci: 	<http://www.ics.forth.gr/isl/CRMsci> .
@prefix base: 		<http://www.ics.forth.gr/isl/CRMinf/> .
#@prefix volipi: 	<http://data.sparna.fr/ontologies/volipi#> .
#@prefix skos: 		<http://www.w3.org/2004/02/skos/core> .
@prefix indagine: 	<http://indagine/> .
@prefix this: 		<http://data.mydomain.com/sparnatural-page/sparnatural-config/> .

@prefix dash: 		<http://datashapes.org/dash#> .
@prefix core: 		<http://data.sparna.fr/ontologies/sparnatural-config-core#> .
@prefix datasources: <http://data.sparna.fr/ontologies/sparnatural-config-datasources#> .


this:S13SampleCampioneLabel sh:path rdfs:label ;
	sh:name "Label campione" ; 
	sh:nodeKind sh:Literal ;
	sh:datatype rdf:string ;
	dash:searchWidget core:NonSelectableProperty ; # ???
	#dash:searchWidget core:SearchProperty ;
	dash:propertyRole dash:LabelRole ;
	core:enableOptional "false"^^xsd:boolean ;
	core:enableNegation "false"^^xsd:boolean .

this:S13SampleCampione # CAMPIONE
    a sh:NodeShape ;
    sh:targetClass j.0:S13_Sample ;
	rdfs:label "Campione" ;
	sh:property [
        sh:path crm:P48_has_preferred_identifier ;
		sh:node this:E42IdentifierCampione ;
		sh:name "ha identificativo" ;
    ] ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeCampione ;
		sh:name "ha tipo" ; 
    ] ;
	sh:property [
        sh:path j.0:O25_contains ;
        sh:node this:S10MaterialSubstantial ;
		sh:name "contiene" ;
    ] ;
    sh:property [
        sh:path basecpm:PC43i_uses ;
        sh:node this:CP2ArchitectureWork ;
		sh:name "utilizza" ;
    ] ; 
		sh:property this:S13SampleCampioneLabel .

this:S10MaterialSubstantial # MATERIALE PREVALENTE - CAMPIONE
    a sh:NodeShape ;
    sh:targetClass j.0:S10_Material_Substantial ;
	rdfs:label "Materiale" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeMateriale ;
		sh:name "ha tipo" ;
    ] .

this:CP2ArchitectureWork # BENE DI RIFERIMENTO
    a sh:NodeShape ;
    sh:targetClass basecpm:CP2_Architecture_Work ;
	rdfs:label "Bene di riferimento" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P1_is_identified_by ;
        sh:node this:E41AppellationBene ;
		sh:name "è identificato da" ;
    ] .

this:E42IdentifierCampione # ID CAMPIONE
    a sh:NodeShape ;
    sh:targetClass crm:E42_Identifier ;
	rdfs:label "ID campione" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
		sh:path indagine:id_campione ;
		sh:name "ID" ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] .

this:E41AppellationBene # DENOMINAZIONE BENE
    a sh:NodeShape ;
    sh:targetClass crm:E41_Appellation ;
	rdfs:label "Denominazione bene" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
		sh:path indagine:denominazione_bene ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "denominazione" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] .
		
this:E55TypeCampione # TIPO CAMPIONE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
    rdfs:label "Tipo campione" ;
    sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_campione ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_campione ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55TypeMateriale # TIPO MATERIALE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
    rdfs:label "Tipo materiale" ;
    sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:materiale ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_materiale ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .


# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO CAMPIONE" (21)
this:tree_root_tipo_campione a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/tipo-campione> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO MATERIALE" (11)
this:tree_root_tipo_materiale a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/materiale> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO SUCCESSIVI 1° LIVELLO (vale per tutti i vocabolari)
this:tree_children_broader_term a datasources:SparqlTreeChildrenDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?uri ?label (EXISTS { ?child crm:P127_has_broader_term ?uri } AS ?hasChildren)
WHERE {
    ?uri crm:P127_has_broader_term $node .
    OPTIONAL { ?uri rdfs:label ?label . }
}
ORDER BY ?label
""" .    
