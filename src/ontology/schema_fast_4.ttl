@prefix sh:   		<http://www.w3.org/ns/shacl#> .
#@prefix ex:		<http://example.org/shapes/> .
@prefix rdf:  		<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: 		<http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:  		<http://www.w3.org/2001/XMLSchema#> .
@prefix owl:  		<http://www.w3.org/2002/07/owl#> .
@prefix crm:  		<http://www.cidoc-crm.org/cidoc-crm/> .
@prefix basecpm: 	<http://ontome.net/ns/cpm/> .
@prefix j.0: 		<http://www.cidoc-crm.org/extensions/crmsci/> . 
#@prefix crmsci: 	<http://www.ics.forth.gr/isl/CRMsci> .
@prefix base: 		<http://www.ics.forth.gr/isl/CRMinf/> .
#@prefix volipi: 	<http://data.sparna.fr/ontologies/volipi#> .
#@prefix skos: 		<http://www.w3.org/2004/02/skos/core> .
@prefix indagine: 	<http://indagine/> .
@prefix this: 		<http://data.mydomain.com/sparnatural-page/sparnatural-config/> .

@prefix dash: 		<http://datashapes.org/dash#> .
@prefix core: 		<http://data.sparna.fr/ontologies/sparnatural-config-core#> .
@prefix datasources: <http://data.sparna.fr/ontologies/sparnatural-config-datasources#> .


this:S10MaterialSubstantialLabel # LABEL MATERIALE PREVALENTE - CAMPIONE-ELEMENTO COSTRUTTIVO
	sh:path rdfs:label ;
	sh:name "Label materiale" ;
	sh:nodeKind sh:Literal ;
	sh:datatype rdf:string ;
	dash:searchWidget core:NonSelectableProperty ; # ???
	dash:propertyRole dash:LabelRole ;
	core:enableOptional "false"^^xsd:boolean ;
	core:enableNegation "false"^^xsd:boolean .

this:CP9MaterialLabel # LABEL MATERIALE PREVALENTE COSTRUTTIVO - ELEMENTO COSTRUTTIVO
	sh:path rdfs:label ;
	sh:name "Label materiale costruttivo" ;
	sh:nodeKind sh:Literal ;
	sh:datatype rdf:string ;
	dash:searchWidget core:NonSelectableProperty ; # ???
	dash:propertyRole dash:LabelRole ;
	core:enableOptional "false"^^xsd:boolean ;
	core:enableNegation "false"^^xsd:boolean .

this:S10MaterialSubstantial # MATERIALE PREVALENTE - CAMPIONE-ELEMENTO COSTRUTTIVO
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass j.0:S10_Material_Substantial ;
	rdfs:label "Materiale prevalente" ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeMateriale ;
		sh:name "ha tipo" ;
    ] ;
    sh:property [
        sh:path [ sh:inversePath j.0:O25_contains ] ; # proprietà inversa: j.0:O25i_is_contained_in
        sh:node this:S13SampleCampione ;
		sh:name "è campionato da" ; 
    ] ; 
    sh:property [
        sh:path [ sh:inversePath j.0:O25_contains ] ; # proprietà inversa: j.0:O25i_is_contained_in
        sh:node this:CP20ConstructionWork ;
		sh:name "è contenuto in" ;
    ] ; 
		sh:property this:S10MaterialSubstantialLabel .

this:CP9Material # MATERIALE PREVALENTE COSTRUTTIVO - ELEMENTO COSTRUTTIVO
    a sh:NodeShape ;
    sh:targetClass basecpm:CP9_Building_Material ;
	rdfs:label "Materiale prevalente costruttivo" ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeMateriale ;
		sh:name "ha tipo" ;
    ] ;
    sh:property [
        sh:path [ sh:inversePath basecpm:PC41_shows_as_main_material ] ; # proprietà inversa: basecpm:PC41i_is_shown_as_main_material
        sh:node this:CP20ConstructionWork ;
		sh:name "è contenuto in" ;
    ] ; 
		sh:property this:CP9MaterialLabel .
	
this:S13SampleCampione # CAMPIONE
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass j.0:S13_Sample ;
	rdfs:label "Campione" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P48_has_preferred_identifier ;
		sh:node this:E42IdentifierCampione ;
		sh:name "ha identificativo" ;
    ] ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55Type04Shape ;
		sh:name "ha tipo" ; 
    #] ;
    #sh:property [
    #    sh:path basecpm:PC43i_uses ;
    #    sh:node this:CP2ArchitectureWork ;
	#	 sh:name "utilizza" ;
    ] .
	
this:CP20ConstructionWork # ELEMENTO COSTRUTTIVO
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass basecpm:CP20_Construction_Work ;
	rdfs:label "Elemento costruttivo" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path [ sh:inversePath crm:P46_is_composed_of ] ; # proprietà inversa: crm:P46i_forms_part_of
		sh:node this:CP2ArchitectureWork ;
		sh:name "è parte di" ;
    ] ;
	sh:property [
        sh:path crm:P62_depicts ;
        sh:node this:I2Belief ;
		sh:name "rappresenta" ;
    ] .

this:CP2ArchitectureWork # BENE DI RIFERIMENTO
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass basecpm:CP2_Architecture_Work ;
	rdfs:label "Bene di riferimento" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P1_is_identified_by ;
        sh:node this:E41AppellationBene ;
		sh:name "è identificato da" ;
    ] .

this:E41AppellationBene # DENOMINAZIONE BENE
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass crm:E41_Appellation ;
	rdfs:label "Denominazione bene" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path indagine:denominazione_bene ;
		sh:datatype xsd:string ;
        sh:name "denominazione" ;
		sh:nodeKind sh:Literal ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] .
	
this:E42IdentifierCampione # ID CAMPIONE
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass crm:E42_Identifier ;
	rdfs:label "ID campione" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path indagine:id_campione ;
		sh:name "ID" ;
		sh:datatype xsd:string ;
    ] .

this:E55TypeMateriale # TIPO MATERIALE (in CAMPIONE, SOTTOCAMPIONE, ELEMENTO COSTRUTTIVO, OUTPUT, ...)
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tipo materiale" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_materiale ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_materiale ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:I2Belief # INQUADRAMENTO CRONOLOGICO
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass base:I2_Belief ;
	rdfs:label "Inquadramento cronologico" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:inquadramento_cronologico ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_inquadramento_cronologico ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55Type04Shape # TIPO CAMPIONE
    a sh:NodeShape, rdfs:Class ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tipo campione" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_campione ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_campione ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .


# DATASOURCE DEI TERMINI DI VOCABOLARIO "INQUADRAMENTO CRONOLOGICO" (9)
this:tree_root_inquadramento_cronologico a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/inquadramento-cronologico> AS ?root)
    ?concept crm:P127_has_broader_term ?root .
    OPTIONAL { ?concept rdfs:label ?label . }
}
ORDER BY ?id""" .
		
# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO CAMPIONE" (21)
this:tree_root_tipo_campione a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/tipo-campione> AS ?root)
    ?concept crm:P127_has_broader_term ?root .
    OPTIONAL { ?concept rdfs:label ?label . }
}
ORDER BY ?id""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO MATERIALE" (11)
this:tree_root_tipo_materiale a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/materiale> AS ?root)
    ?concept crm:P127_has_broader_term ?root .
    OPTIONAL { ?concept rdfs:label ?label . }
}
ORDER BY ?id""" .


# DATASOURCE DEI TERMINI DI VOCABOLARIO SUCCESSIVI 1° LIVELLO (vale per tutti i vocabolari)
this:tree_children_broader_term a datasources:SparqlTreeChildrenDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?uri ?label (EXISTS { ?child crm:P127_has_broader_term ?uri } AS ?hasChildren)
WHERE {
    ?uri crm:P127_has_broader_term $node .
    OPTIONAL { ?uri rdfs:label ?label . }
}
ORDER BY ?id""" .    
