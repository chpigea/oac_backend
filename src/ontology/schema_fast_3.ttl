@prefix sh:   		<http://www.w3.org/ns/shacl#> .
#@prefix ex:   		<http://example.org/shapes/> .
@prefix rdf:  		<http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: 		<http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd:  		<http://www.w3.org/2001/XMLSchema#> .
@prefix owl:  		<http://www.w3.org/2002/07/owl#> .
@prefix crm:  		<http://www.cidoc-crm.org/cidoc-crm/> .
@prefix basecpm: 	<http://ontome.net/ns/cpm/> .
@prefix j.0: 		<http://www.cidoc-crm.org/extensions/crmsci/> . 
#@prefix crmsci: 	<http://www.ics.forth.gr/isl/CRMsci> .
@prefix base: 		<http://www.ics.forth.gr/isl/CRMinf/> .
#@prefix volipi: 	<http://data.sparna.fr/ontologies/volipi#> .
#@prefix skos: 		<http://www.w3.org/2004/02/skos/core> .
@prefix indagine: 	<http://indagine/> .
@prefix this: 		<http://data.mydomain.com/sparnatural-page/sparnatural-config/> .

@prefix dash: 		<http://datashapes.org/dash#> .
@prefix core: 		<http://data.sparna.fr/ontologies/sparnatural-config-core#> .
@prefix datasources: <http://data.sparna.fr/ontologies/sparnatural-config-datasources#> .


this:E7ActivityDiagnosticaLabel sh:path rdfs:label ; # LABEL ATTIVITA' DIAGNOSTICA
	sh:name "Label attività diagnostica" ; 
	sh:nodeKind sh:Literal ;
	sh:datatype rdf:string ;
	dash:searchWidget core:NonSelectableProperty;
	dash:propertyRole dash:LabelRole ;
	core:enableOptional "false"^^xsd:boolean ;
	core:enableNegation "false"^^xsd:boolean .

this:E7ActivityDiagnostica # ATTIVITA' DIAGNOSTICA
    a sh:NodeShape ;
    sh:targetClass crm:E7_Activity ;
	rdfs:label "Attività diagnostica" ;
	sh:property [
        sh:path crm:P48_has_preferred_identifier ;
		sh:node this:E42IdentifierAttivitaDiagnostica ;
		sh:name "ha identificativo" ;
    ] ;
    sh:property [
        sh:path crm:P14_carried_out_by ;
        sh:node this:E39ActorDiagnostica ;
		sh:name "eseguito da" ;
    ] ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeTecnica ;
		sh:name "ha tipo" ; 
    ] ;
    sh:property [
        sh:path crm:P33_used_specific_technique ;
        sh:node this:E29DesignorProcedureDiagnostica ; 
		sh:name "ha usato tecnica specifica" ;
    ] ;
    sh:property [
        sh:path crm:P16_used_specific_object ; 
        sh:node this:E70ThingStrumento ; 
		sh:name "ha usato un oggetto specifico" ;
    ] ;
    sh:property [
        sh:path crm:P12_occurred_in_the_presence_of ;
        sh:node this:S13SampleCampione ;
		sh:name "avvenuto in presenza di" ;
    ] ;
		sh:property this:E7ActivityDiagnosticaLabel .
	
this:E70ThingStrumento # STRUMENTO 
    a sh:NodeShape ;
    sh:targetClass crm:E70_Thing ;
	rdfs:label "Strumento" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P2_has_type ;
		sh:node this:E55TypeStrumentazione ; 
		sh:name "ha tipo" ;
    ] .
	
this:E29DesignorProcedureDiagnostica # PROCEDURA 
    a sh:NodeShape ;
    sh:targetClass crm:E29_Design_or_Procedure ;
	rdfs:label "Procedura" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P2_has_type ;
		sh:node this:E55TypeModalitaIndagine ; 
		sh:name "ha tipo" ;
    ] .

this:S13SampleCampione # CAMPIONE
    a sh:NodeShape ;
    sh:targetClass j.0:S13_Sample ;
	rdfs:label "Campione" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeCampione ;
		sh:name "ha tipo" ;
    ] ;
	sh:property [
        sh:path j.0:O25_contains ;
        sh:node this:S10MaterialSubstantial ;
		sh:name "contiene" ;
    ] ;
    sh:property [
        sh:path basecpm:PC43i_uses ;
        sh:node this:CP2ArchitectureWork ;
		sh:name "utilizza" ;
    ] .

this:S10MaterialSubstantial # MATERIALE PREVALENTE - CAMPIONE
    a sh:NodeShape ;
    sh:targetClass j.0:S10_Material_Substantial ;
	rdfs:label "Materiale" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path crm:P2_has_type ;
        sh:node this:E55TypeMateriale ;
		sh:name "ha tipo" ;
    ] .

this:CP2ArchitectureWork # BENE DI RIFERIMENTO
    a sh:NodeShape ;
    sh:targetClass basecpm:CP2_Architecture_Work ;
	rdfs:label "Bene di riferimento" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path crm:P1_is_identified_by ;
        sh:node this:E41AppellationBene ;
		sh:name "è identificato da" ;
    ] .

this:E42IdentifierAttivitaDiagnostica # ID ATTIVITA' DIAGNOSTICA
    a sh:NodeShape ;
    sh:targetClass crm:E42_Identifier ;
	rdfs:label "ID attività diagnostica" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
        sh:path indagine:id_attivita_diagnostica ;
		sh:name "ID" ;
		sh:datatype xsd:string ;
    ] .

this:E39ActorDiagnostica # AUTORE
    a sh:NodeShape ;
    sh:targetClass crm:E39_Actor ;
	rdfs:label "Autore" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:autore ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "autore" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] ;
    sh:property [
        sh:path crm:P107i_is_current_or_former_member_of ;
        sh:node this:E74GroupEnte ;
		sh:name "è membro di" ;
    ] .

this:E74GroupEnte # ENTE AUTORE
    a sh:NodeShape ;
    sh:targetClass crm:E74_Group ;
	rdfs:label "Ente autore" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:ente_autore ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "ente" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
        #sh:maxCount 1 ; 
    ] .
    
this:E41AppellationBene # DENOMINAZIONE BENE
    a sh:NodeShape ;
    sh:targetClass crm:E41_Appellation ;
	rdfs:label "Denominazione bene" ;
	sh:deactivated "true"^^xsd:boolean ;
	sh:property [
		sh:path indagine:denominazione_bene ;
		sh:datatype xsd:string ;
		sh:nodeKind sh:Literal ;
		sh:name "denominazione" ;
		dash:searchWidget core:AutocompleteProperty ;
		dash:propertyRole dash:LabelRole ;
		core:enableOptional "true"^^xsd:boolean ;
		core:enableNegation "true"^^xsd:boolean ;
    ] .
	
this:E55TypeCampione # TIPO CAMPIONE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
    rdfs:label "Tipo campione" ;
    sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_campione ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_campione ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55TypeMateriale # TIPO MATERIALE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
    rdfs:label "Tipo materiale" ;
    sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_materiale ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tipo_materiale ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55TypeTecnica # TECNICA DIAGNOSTICA
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tecnica diagnostica" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tecnica_diagnostica ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_tecnica_diagnostica ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55TypeModalitaIndagine # TIPO MODALITA' INDAGINE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tipo modalità indagine" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_modalita_indagine ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_modalita_indagine ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .

this:E55TypeStrumentazione # TIPO STRUMENTAZIONE
    a sh:NodeShape ;
    sh:targetClass crm:E55_Type ;
	rdfs:label "Tipo strumentazione" ;
	sh:deactivated "true"^^xsd:boolean ;
    sh:property [
        sh:path indagine:tipo_strumentazione ;
        sh:name "tipo" ;
        dash:searchWidget core:TreeProperty ;
        core:enableOptional "true"^^xsd:boolean;
        core:enableNegation "true"^^xsd:boolean;
        datasources:treeRootsDatasource this:tree_root_strumentazione ;
        datasources:treeChildrenDatasource this:tree_children_broader_term ;
    ] .


# DATASOURCE DEI TERMINI DI VOCABOLARIO "STRUMENTAZIONE" (18)
this:tree_root_strumentazione a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/strumentazione> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "MODALITA' INDAGINE" (13)
this:tree_root_modalita_indagine a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/modalita-di-indagine> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "TECNICA DIAGNOSTICA" (20)
this:tree_root_tecnica_diagnostica a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/tecnica-diagnostica> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO CAMPIONE" (21)
this:tree_root_tipo_campione a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/tipo-campione> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO "TIPO MATERIALE" (11)
this:tree_root_tipo_materiale a datasources:SparqlTreeRootDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT (?concept AS ?uri) ?label (EXISTS { ?child crm:P127_has_broader_term ?concept } AS ?hasChildren)
WHERE {
    BIND(<http://diagnostica/vocabularies/materiale> AS ?concept)
    OPTIONAL { ?concept rdfs:label ?label . }
}""" .

# DATASOURCE DEI TERMINI DI VOCABOLARIO SUCCESSIVI 1° LIVELLO (vale per tutti i vocabolari)
this:tree_children_broader_term a datasources:SparqlTreeChildrenDatasource;
    datasources:queryString """
PREFIX crm:  <http://www.cidoc-crm.org/cidoc-crm/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT ?uri ?label (EXISTS { ?child crm:P127_has_broader_term ?uri } AS ?hasChildren)
WHERE {
    ?uri crm:P127_has_broader_term $node .
    OPTIONAL { ?uri rdfs:label ?label . }
}
ORDER BY ?label
""" .    
